<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Suivi logements AHMP</title>
<style>
html, body { height:100%; margin:0; padding:0; font-family:sans-serif; background:#111; color:#fff; overflow-x:hidden; }
#fond { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }

#fond span { position:absolute; font-size:12px; opacity:0.8; user-select:none; }

.app { max-width:500px; margin:auto; padding:20px; position:relative; z-index:1; }

.animated-title { font-size:3em; text-align:center; color:#E6007E; animation: slideDown 0.8s forwards; }

@keyframes slideDown { from { opacity:0; transform:translateY(-50px); } to { opacity:1; transform:translateY(0); } }
@keyframes slideUp { from { opacity:0; transform:translateY(50px); } to { opacity:1; transform:translateY(0); } }
@keyframes pulse { 0% { transform:scale(1); color:#E6007E; } 50% { transform:scale(1.1); color:#FF00AA; } 100% { transform:scale(1); color:#E6007E; } }

.input-group { margin:15px 0; display:flex; flex-direction:column; animation: slideDown 1s forwards; opacity:0; transition: opacity 0.5s; }
.input-group label { margin-bottom:5px; font-weight:bold; color:#fff; font-size:1.5em; text-align:center; }

.select-ios {
  font-size:1.5em;
  padding:12px;
  border-radius:12px;
  border:2px solid #E6007E;
  background:#222;
  color:#fff;
  -webkit-appearance: none;
  text-align:center;
  opacity:1;
  transition: opacity 0.5s;
}
.select-ios option { background:#222; color:#fff; }

.button { background:#E6007E; color:white; border:none; padding:14px; border-radius:12px; font-size:1.2em; font-weight:600; margin-top:10px; cursor:pointer; width:100%; animation: slideUp 0.8s forwards; transition: transform 0.1s; }
.button:hover { background:#B20066; }
.button:active { animation:pulse 0.3s; transform:scale(1.05); }

.logement { background:#222; padding:10px; margin-top:8px; border-radius:8px; border:1px solid #E6007E; color:#fff; opacity:0; transition: opacity 0.3s; }
.logement.show { opacity:1; }

.counter { text-align:center; font-size:1.5em; margin:15px 0; font-weight:bold; color:#E6007E; }
#liste, #listeRendezVous { max-height:50vh; overflow-y:auto; -webkit-overflow-scrolling: touch; margin-top:10px; padding-right:5px; }
.chip { background:#222; border:1px solid #E6007E; border-radius:12px; padding:5px 10px; color:#fff; font-weight:bold; display:flex; align-items:center; gap:5px; margin:2px; }
.chip button { background:transparent; border:none; color:#FF4444; cursor:pointer; font-weight:bold; }
</style>
</head>
<body>

<div id="fond"></div>

<div class="app" id="startScreen">
  <h1 class="animated-title">ðŸª³ AHMP ðŸª³</h1>
  <div class="input-group">
    <label>Nombre total de logements :</label>
    <select id="totalInput" class="select-ios">
      <option value="" disabled selected>SÃ©lectionner</option>
    </select>
  </div>
  <div class="input-group">
    <label>Nombre de rendez-vous :</label>
    <select id="totalRdv" class="select-ios">
      <option value="" disabled selected>SÃ©lectionner</option>
    </select>
  </div>
  <div class="input-group" id="rdvSelection" style="display:none;">
    <label>Ajouter logements RDV :</label>
    <div style="display:flex; gap:5px; align-items:center; margin-bottom:5px;">
      <select id="rendezVousInput" class="select-ios">
        <option value="" disabled selected>SÃ©lectionner</option>
      </select>
      <button class="button" onclick="ajouterRdvTemp()">Ajouter RDV</button>
    </div>
    <div id="listeRdvTemp" style="display:flex; flex-wrap:wrap; gap:5px;"></div>
  </div>
  <button class="button" id="btnToMain" style="display:none;" onclick="goToMain()">Suivant</button>
</div>

<div class="app" id="mainScreen" style="display:none;">
  <h1 class="animated-title">ðŸª³ Ajouter logement</h1>
  <div class="input-group">
    <label>NumÃ©ro du logement :</label>
    <select id="numInput" class="select-ios">
      <option value="" disabled selected>SÃ©lectionner</option>
    </select>
  </div>
  <div class="input-group">
    <label>Ã‰tage :</label>
    <select id="etageInput" class="select-ios">
      <option value="" disabled selected>SÃ©lectionner</option>
    </select>
  </div>
  <button class="button" onclick="ajouterLogement()">Ajouter logement</button>
  <button class="button" style="background:#AA0070; margin-top:10px;" onclick="resetApp()">RÃ©initialiser</button>

  <div id="liste"></div>
  <div class="counter" id="compteur">0 / 0</div>

  <h2 style="text-align:center; color:#FF69B4;">Logements avec RDV</h2>
  <div class="counter" id="compteurRdv">0 / 0</div>
  <div id="listeRendezVous" style="max-height:30vh; overflow-y:auto; -webkit-overflow-scrolling:touch;"></div>
</div>

<script>
// Fond dÃ©coratif
let fond=document.getElementById('fond'); fond.innerHTML="";
const motifs=[{char:'AHMP',color:'rgba(255,0,200,0.7)'},{char:'ðŸª³',color:'rgba(255,255,255,0.7)'},{char:'ðŸ’‰',color:'rgba(255,255,255,0.7)'}];
for(let i=0;i<15;i++){ for(let j=0;j<12;j++){
  const span=document.createElement('span'); const motif=motifs[(i*12+j)%motifs.length];
  span.textContent=motif.char; span.style.color=motif.color;
  span.style.top=`${i*70}px`; span.style.left=`${j*70}px`; span.style.fontSize='12px'; fond.appendChild(span);
}}

let total=0, totalRdvCount=0, logements=[], rendezVousTemp=[], rendezVousInitial=[];

// Remplissage menu
const totalSelect=document.getElementById('totalInput'); for(let i=1;i<=100;i++){const opt=document.createElement("option"); opt.value=i; opt.textContent=i; totalSelect.appendChild(opt);}
const totalRdvSelect=document.getElementById('totalRdv'); for(let i=0;i<=100;i++){const opt=document.createElement("option"); opt.value=i; opt.textContent=i; totalRdvSelect.appendChild(opt);}

document.getElementById('totalRdv').addEventListener('change',function(){
  totalRdvCount=parseInt(this.value);
  rendezVousInitial=[];
  const rdvInput=document.getElementById('rendezVousInput'); rdvInput.innerHTML='<option value="" disabled selected>SÃ©lectionner</option>';
  if(totalRdvCount>0){
    document.getElementById('rdvSelection').style.display='block';
    const max=parseInt(document.getElementById('totalInput').value);
    for(let i=1;i<=max;i++){const opt=document.createElement("option"); opt.value=i; opt.textContent=i; rdvInput.appendChild(opt);}
  }
  document.getElementById('btnToMain').style.display='block';
});

function ajouterRdvTemp(){
  if(rendezVousTemp.length >= totalRdvCount) return;
  const num=parseInt(document.getElementById('rendezVousInput').value);
  if(!num || rendezVousTemp.includes(num)) return;
  rendezVousTemp.push(num);
  rendezVousInitial.push(num);
  const div=document.getElementById('listeRdvTemp');
  const chip=document.createElement('div'); chip.className='chip'; chip.textContent=num;
  const btnRemove=document.createElement('button'); btnRemove.textContent="âœ•";
  btnRemove.onclick=()=>{rendezVousTemp=rendezVousTemp.filter(n=>n!==num); rendezVousInitial=rendezVousInitial.filter(n=>n!==num); div.removeChild(chip); majCompteur(); document.getElementById('rendezVousInput').disabled=false;};
  chip.appendChild(btnRemove); div.appendChild(chip);
  const optionToRemove=Array.from(document.getElementById('rendezVousInput').options).find(o=>parseInt(o.value)===num); if(optionToRemove) optionToRemove.remove();
  if(rendezVousTemp.length >= totalRdvCount) document.getElementById('rendezVousInput').disabled=true;
  majCompteur();
}

function goToMain(){
  total=parseInt(document.getElementById('totalInput').value); logements=[];
  document.getElementById('startScreen').style.display='none'; document.getElementById('mainScreen').style.display='block';

  const numSelect=document.getElementById('numInput'); numSelect.innerHTML='<option value="" disabled selected>SÃ©lectionner</option>'; for(let i=1;i<=total;i++){const opt=document.createElement("option"); opt.value=i; opt.textContent=i; numSelect.appendChild(opt);}
  const etageSelect=document.getElementById('etageInput'); etageSelect.innerHTML='<option value="" disabled selected>SÃ©lectionner</option>'; for(let i=-2;i<=10;i++){const opt=document.createElement("option"); opt.value=i; opt.textContent=i; etageSelect.appendChild(opt);}
  majCompteur(); majListe(); majListeRdv();
}

function ajouterLogement(){
  const num=parseInt(document.getElementById('numInput').value); const etage=parseInt(document.getElementById('etageInput').value);
  if(!num || isNaN(num)) return alert("SÃ©lectionnez un numÃ©ro de logement !");
  if(isNaN(etage)) return alert("SÃ©lectionnez un Ã©tage !");
  if(logements.some(l=>l.numero===num)) return alert("Logement dÃ©jÃ  ajoutÃ© !");
  logements.push({numero:num, etage:etage});
  // Retirer de RDV si c'Ã©tait un RDV
  if(rendezVousInitial.includes(num)) { const index=rendezVousTemp.indexOf(num); if(index>-1) rendezVousTemp.splice(index,1);}
  majCompteur(); majListe(); majListeRdv();
  document.getElementById('numInput').value=""; document.getElementById('etageInput').value="";
  document.getElementById('numInput').selectedIndex=0; document.getElementById('etageInput').selectedIndex=0;
}

function majListe(){
  const div=document.getElementById('liste'); div.innerHTML="";
  logements.forEach(l=>{ const el=document.createElement("div"); el.className="logement show"; el.textContent="Logement "+l.numero+" â€” Ã‰tage "+l.etage; div.appendChild(el);});
}

function majListeRdv(){
  const div=document.getElementById('listeRendezVous'); div.innerHTML="";
  rendezVousInitial.forEach(r=>{
    const done=logements.some(l=>l.numero===r);
    const el=document.createElement("div"); el.className="chip"; el.textContent=r+(done?" âœ…":"");
    div.appendChild(el);
  });
}

function majCompteur(){
  document.getElementById("compteur").textContent=logements.length+" / "+total;
  const rdvEffectues=rendezVousInitial.filter(r=>logements.some(l=>l.numero===r)).length;
  document.getElementById('compteurRdv').textContent=rdvEffectues+" / "+rendezVousInitial.length;
}

function resetApp(){
  if(!confirm("Voulez-vous rÃ©initialiser ?")) return;
  logements=[]; rendezVousTemp=[]; rendezVousInitial=[]; total=0; totalRdvCount=0;
  document.getElementById('startScreen').style.display='block'; document.getElementById('mainScreen').style.display='none';
  document.getElementById('totalInput').selectedIndex=0; document.getElementById('totalRdv').selectedIndex=0;
  document.getElementById('rdvSelection').style.display='none';
  document.getElementById('btnToMain').style.display='none';
}
</script>

</body>
</html>
